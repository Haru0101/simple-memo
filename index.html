<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple memos</title>
</head>

<body>
    <div id="app">
        <h1>Simple memos</h1>
        <!-- 送信して違うページに行かないようにサブミットを制御 -->
        <form v-on:submit.prevent>
            <label for="title">タイトル<br><input type="text" name="title" id="title" v-model="newItem.title"></label><br>
            <label for="body">内容<br><textarea id="body" v-model="newItem.body"></textarea></label>
            <button @click="addItem">Add</button>
            <h2>メモ一覧</h2>
            <ul>
                <template v-for="(item, index) in items">
                    <li :key="index"><input type="checkbox" name="" id="dd"><label for="dd">
                        <h2>{{ item.title }}</h2>
                        <p>{{ item.body }}</p>
                        <date>{{ item.dates }}</date>
                    </label>
                    </li>
                </template>
            </ul>
            <button v-on:click="deleteItemChecked()">チェック済みの項目を削除する</button>
            <button @click="resetStorage()">localStorageリセット</button>
            <pre>{{$data}}</pre>

        </form>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script>
        var app = new Vue({
            el: '#app',
            data: {
                newItem: {
                    title: null,
                    body: null,
                    dates: null,
                },
                items: [],
            },
            mounted() {
                this.fetchItem();
            },
            updated() {
                this.updateStorage();
            },
            methods: {
                addItem: function () {
                    if (this.newItem.body == null) return;
                    // オブジェクトをプッシュするときは変数に入れるとスッキリする
                    let now = new Date();
                    let item = {
                        title: this.newItem.title,
                        body: this.newItem.body,
                        dates: now.toLocaleString()
                    };

                    this.items.push(item);
                    // this.updateStorage();
                    console.log(localStorage);
                    this.newItem.title = null;
                    this.newItem.body = null;
                    this.newItem.dates = null;
                    this.updateStorage();
                    // this.fetchItem();
                },
                fetchItem: function () {
                    console.log('fetchItem');
                    console.log(localStorage.length);
                    // ローカルストレージからアイテムをフェッチする関数
                    this.items = JSON.parse(localStorage.getItem('items'));
                    if (!this.items) {
                        this.items = [];
                    }
                },
                resetStorage: function () {
                    localStorage.clear();
                    this.fetchItem();
                },
                updateStorage: function () {
                    console.log('updateStorage');
                    localStorage.setItem('items', JSON.stringify(this.items));
                }
            }
        })
    </script>
    <style>
        body {
            box-sizing: border-box;
        }

        ul {
            display: flex;
            flex-wrap: wrap;
            margin-right: -10px;
        }

        li {
            border: solid 1px #aaa;
            display: block;
            width: calc(100% / 4 - 10px);
            margin-bottom: 10px;
            margin-right: 10px;
        }

        label { 
            padding: 20px;
            display: block;
        }

        input[type=checkbox] {
            border: 0;
            clip: rect(0 0 0 0);
            clip-path: inset(50%);
            height: 1px;
            margin: -1px;
            overflow: hidden;
            padding: 0;
            position: absolute;
            white-space: nowrap;
            width: 1px;
        }

        input[type=checkbox]:checked + label {
            background-color: #aaa;
        }
    </style>
</body>

</html>